<%- include('../partials/header') %>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><%= task.title %></h1>
    <div>
      <a href="/tasks/<%= task.id %>/edit" class="btn btn-outline-primary me-2">
        <i class="fas fa-edit"></i> Edit
      </a>
      <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteTaskModal">
        <i class="fas fa-trash"></i> Delete
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="card shadow-sm mb-4">
        <div class="card-header">
          <h4>Task Details</h4>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <strong>Description:</strong>
            <p><%= task.description || 'No description provided.' %></p>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <strong>Project:</strong>
              <div><a href="/projects/<%= task.project_id %>"><%= task.project_name %></a></div>
            </div>
            
            <div class="col-md-6 mb-3">
              <strong>Assigned To:</strong>
              <div><%= task.assigned_username || 'Unassigned' %></div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-4 mb-3">
              <strong>Due Date:</strong>
              <div><%= task.due_date ? new Date(task.due_date).toLocaleDateString() : 'Not set' %></div>
            </div>
            
            <div class="col-md-4 mb-3">
              <strong>Priority:</strong>
              <div>
                <span class="badge <%= 
                  task.priority === 'Low' ? 'bg-info' : 
                  task.priority === 'Medium' ? 'bg-warning' : 
                  'bg-danger' 
                %>"><%= task.priority %></span>
              </div>
            </div>
            
            <div class="col-md-4 mb-3">
              <strong>Status:</strong>
              <div>
                <span class="badge <%= 
                  task.status === 'To Do' ? 'bg-secondary' : 
                  task.status === 'In Progress' ? 'bg-primary' : 
                  'bg-success' 
                %>"><%= task.status %></span>
              </div>
            </div>
          </div>
          
          <div>
            <strong>Created On:</strong>
            <div><%= new Date(task.created_at).toLocaleString() %></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h4>Quick Actions</h4>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="/projects/<%= task.project_id %>" class="btn btn-outline-primary">
              <i class="fas fa-project-diagram"></i> View Project
            </a>
            
            <form action="/tasks/<%= task.id %>" method="POST">
              <input type="hidden" name="title" value="<%= task.title %>">
              <input type="hidden" name="description" value="<%= task.description || '' %>">
              <input type="hidden" name="project_id" value="<%= task.project_id %>">
              <input type="hidden" name="assigned_to" value="<%= task.assigned_to || '' %>">
              <input type="hidden" name="due_date" value="<%= task.due_date ? task.due_date.toISOString().split('T')[0] : '' %>">
              <input type="hidden" name="priority" value="<%= task.priority %>">
              
              <% if (task.status === 'To Do') { %>
                <input type="hidden" name="status" value="In Progress">
                <button type="submit" class="btn btn-outline-primary w-100 mb-2">
                  <i class="fas fa-play"></i> Start Task
                </button>
              <% } else if (task.status === 'In Progress') { %>
                <input type="hidden" name="status" value="Done">
                <button type="submit" class="btn btn-outline-success w-100 mb-2">
                  <i class="fas fa-check"></i> Complete Task
                </button>
              <% } else if (task.status === 'Done') { %>
                <input type="hidden" name="status" value="To Do">
                <button type="submit" class="btn btn-outline-secondary w-100 mb-2">
                  <i class="fas fa-redo"></i> Reopen Task
                </button>
              <% } %>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteTaskModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete Task</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete "<%= task.title %>"?</p>
          <p class="text-danger"><strong>Warning:</strong> This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form action="/tasks/<%= task.id %>/delete" method="POST">
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %> 